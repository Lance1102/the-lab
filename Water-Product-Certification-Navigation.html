<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水類產品安規與EMC認證導航</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-cyan-100 min-h-screen text-slate-800">

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i data-lucide="droplets" class="h-8 w-8 text-blue-600 mr-3"></i>
                    <span class="font-bold text-xl tracking-tight text-slate-700">水類產品認證導航系統</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="resetApp()" class="text-sm text-slate-500 hover:text-blue-600 transition">重置查詢</button>
                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded border border-blue-400">Beta 1.0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto px-4 py-8">
        
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="step-content active text-center py-12">
            <h1 class="text-4xl font-bold text-slate-800 mb-6">您要認證什麼類型的水家電？</h1>
            <p class="text-lg text-slate-600 mb-10 max-w-2xl mx-auto">
                本系統整合台灣 BSMI 安規 (IEC 60335系列) 與 EMC (CNS 13783) 要求，並納入常見卡關議題（如 PCB 阻燃性判定、進口商溝通斷層）。
            </p>
            <button onclick="startGuide()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transition transform hover:scale-105 flex items-center mx-auto">
                開始評估
                <i data-lucide="arrow-right" class="ml-2 h-5 w-5"></i>
            </button>

            <!-- Cards for Quick Info -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16 text-left">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="bg-red-100 w-10 h-10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="flame" class="text-red-600 h-5 w-5"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">PCB 阻燃性重點</h3>
                    <p class="text-slate-500 text-sm">依據 IEC 60335-1，若 PCB 無明確 UL 94 V-0 標示，可能面臨針焰測試 (Needle Flame Test) 要求。</p>
                </div>
                <div class="bg-amber-100 p-6 rounded-xl shadow-sm border border-amber-200 hover:shadow-md transition">
                    <div class="bg-amber-200 w-10 h-10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="zap" class="text-amber-700 h-5 w-5"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">EMC 常見卡關</h3>
                    <p class="text-slate-600 text-sm">進口產品常因工廠與貿易商技術溝通不良，導致 EMC 測試失敗後修改期長達 1.5 個月以上。</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl shadow-sm border border-blue-100 hover:shadow-md transition">
                    <div class="bg-blue-200 w-10 h-10 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="book-open" class="text-blue-700 h-5 w-5"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">主要法規依據</h3>
                    <p class="text-slate-600 text-sm">涵蓋 BSMI 商品檢驗法、CNS 60335-2-15 (液體加熱器) 及 CNS 60335-2-24 (製冷器具)。</p>
                </div>
            </div>
        </div>

        <!-- Wizard Step 1: Product Type -->
        <div id="step-1" class="step-content glass-panel p-8 rounded-2xl shadow-xl max-w-3xl mx-auto border border-white">
            <div class="mb-6">
                <span class="text-xs font-bold text-blue-500 tracking-wider uppercase">Step 1 / 3</span>
                <h2 class="text-2xl font-bold mt-2">請問您的產品類型是？</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="selectOption('type', 'dispenser')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left group">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-2 rounded-lg mr-3 group-hover:bg-blue-200"><i data-lucide="glass-water" class="text-blue-600"></i></div>
                        <div>
                            <div class="font-bold">開飲機 / 飲水機</div>
                            <div class="text-xs text-slate-500 mt-1">具備加熱或製冷功能，通常有儲水桶。</div>
                        </div>
                    </div>
                </button>
                <button onclick="selectOption('type', 'kettle')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left group">
                    <div class="flex items-center">
                        <div class="bg-orange-100 p-2 rounded-lg mr-3 group-hover:bg-orange-200"><i data-lucide="coffee" class="text-orange-600"></i></div>
                        <div>
                            <div class="font-bold">電熱水瓶 / 快煮壺</div>
                            <div class="text-xs text-slate-500 mt-1">單純加熱液體，無製冷功能。</div>
                        </div>
                    </div>
                </button>
                <button onclick="selectOption('type', 'filter_electric')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left group">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-2 rounded-lg mr-3 group-hover:bg-green-200"><i data-lucide="filter" class="text-green-600"></i></div>
                        <div>
                            <div class="font-bold">電動淨水器 (RO機)</div>
                            <div class="text-xs text-slate-500 mt-1">含馬達、控制板，但不一定加熱。</div>
                        </div>
                    </div>
                </button>
                <button onclick="selectOption('type', 'other')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left group">
                    <div class="flex items-center">
                        <div class="bg-slate-100 p-2 rounded-lg mr-3 group-hover:bg-slate-200"><i data-lucide="help-circle" class="text-slate-600"></i></div>
                        <div>
                            <div class="font-bold">其他 / 純過濾器材</div>
                            <div class="text-xs text-slate-500 mt-1">濾水壺、龍頭式濾水器 (無電源)。</div>
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Wizard Step 2: Components -->
        <div id="step-2" class="step-content glass-panel p-8 rounded-2xl shadow-xl max-w-3xl mx-auto border border-white">
            <div class="mb-6">
                <span class="text-xs font-bold text-blue-500 tracking-wider uppercase">Step 2 / 3</span>
                <h2 class="text-2xl font-bold mt-2">產品包含哪些關鍵組件？(可複選)</h2>
            </div>
            <div class="space-y-3">
                <label class="flex items-center p-4 border rounded-xl cursor-pointer hover:bg-slate-50 transition">
                    <input type="checkbox" id="comp_compressor" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                    <span class="ml-3 font-medium flex-1">壓縮機 (Compressor) - 用於冰水功能</span>
                    <i data-lucide="snowflake" class="text-slate-400 h-5 w-5"></i>
                </label>
                <label class="flex items-center p-4 border rounded-xl cursor-pointer hover:bg-slate-50 transition">
                    <input type="checkbox" id="comp_heater" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                    <span class="ml-3 font-medium flex-1">加熱器 (Heater) - 電熱管、加熱片</span>
                    <i data-lucide="flame" class="text-slate-400 h-5 w-5"></i>
                </label>
                <label class="flex items-center p-4 border rounded-xl cursor-pointer hover:bg-slate-50 transition">
                    <input type="checkbox" id="comp_pcb" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300" checked>
                    <span class="ml-3 font-medium flex-1">電子控制板 (PCB) / 顯示螢幕</span>
                    <i data-lucide="cpu" class="text-slate-400 h-5 w-5"></i>
                </label>
                <label class="flex items-center p-4 border rounded-xl cursor-pointer hover:bg-slate-50 transition">
                    <input type="checkbox" id="comp_wifi" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                    <span class="ml-3 font-medium flex-1">無線功能 (Wi-Fi / Bluetooth)</span>
                    <i data-lucide="wifi" class="text-slate-400 h-5 w-5"></i>
                </label>
            </div>
            <div class="mt-8 flex justify-between">
                <button onclick="prevStep()" class="text-slate-500 hover:text-slate-800 font-medium px-6 py-2">上一步</button>
                <button onclick="saveStep2()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded-lg shadow transition">下一步</button>
            </div>
        </div>

        <!-- Wizard Step 3: Origin & Supply Chain -->
        <div id="step-3" class="step-content glass-panel p-8 rounded-2xl shadow-xl max-w-3xl mx-auto border border-white">
            <div class="mb-6">
                <span class="text-xs font-bold text-blue-500 tracking-wider uppercase">Step 3 / 3</span>
                <h2 class="text-2xl font-bold mt-2">產品產地與供應鏈模式</h2>
                <p class="text-sm text-slate-500 mt-2">這關係到 BSMI 驗證登錄的申請人資格與工廠檢查流程。</p>
            </div>
            <div class="grid grid-cols-1 gap-4">
                <button onclick="selectOption('origin', 'taiwan')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left">
                    <div class="font-bold">台灣製造 (MIT)</div>
                    <div class="text-xs text-slate-500">工廠在台灣，申請人為國內製造商。</div>
                </button>
                <button onclick="selectOption('origin', 'china_trade')" class="option-btn p-4 border-2 border-red-100 rounded-xl hover:border-red-500 hover:bg-red-50 transition text-left">
                    <div class="font-bold text-red-900">中國進口 (透過貿易商採購)</div>
                    <div class="text-xs text-red-700">通過中間商 (Trading Company) 購買，無法直接聯繫工廠技術人員。</div>
                </button>
                <button onclick="selectOption('origin', 'china_direct')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left">
                    <div class="font-bold">中國進口 (自有工廠/直對工廠)</div>
                    <div class="text-xs text-slate-500">能直接取得工廠技術文件 (電路圖、BOM表)。</div>
                </button>
                <button onclick="selectOption('origin', 'other_import')" class="option-btn p-4 border-2 border-slate-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition text-left">
                    <div class="font-bold">其他國家進口</div>
                    <div class="text-xs text-slate-500">歐美日韓等地區。</div>
                </button>
            </div>
            <div class="mt-8 flex justify-between">
                <button onclick="prevStep()" class="text-slate-500 hover:text-slate-800 font-medium px-6 py-2">上一步</button>
                <!-- Final trigger is handled by selectOption -->
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="step-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Main Report -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Status Header -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-blue-600">
                        <h2 class="text-2xl font-bold text-slate-800">認證路徑分析報告</h2>
                        <div id="result-summary" class="mt-2 text-slate-600"></div>
                    </div>

                    <!-- Standards List -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i data-lucide="clipboard-check" class="text-blue-600 mr-2"></i>
                            應施檢驗項目 (BSMI)
                        </h3>
                        <div id="standards-list" class="space-y-4">
                            <!-- Dynamic Content -->
                        </div>
                    </div>

                    <!-- Technical Risks -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-red-100">
                        <h3 class="text-xl font-bold mb-4 flex items-center text-red-700">
                            <i data-lucide="alert-triangle" class="text-red-600 mr-2"></i>
                            技術與法規風險預警
                        </h3>
                        <div id="risk-list" class="space-y-4">
                            <!-- Dynamic Content -->
                        </div>
                    </div>
                </div>

                <!-- Sidebar Info -->
                <div class="space-y-6">
                    <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-lg">
                        <h3 class="font-bold text-lg mb-3">下一步行動</h3>
                        <ul class="space-y-3 text-sm text-slate-300">
                            <li class="flex items-start"><i data-lucide="check-circle" class="w-4 h-4 mr-2 mt-1 text-green-400"></i>準備樣機 2-3 台 (包含一台拆解樣)</li>
                            <li class="flex items-start"><i data-lucide="check-circle" class="w-4 h-4 mr-2 mt-1 text-green-400"></i>準備電路圖、Block Diagram</li>
                            <li class="flex items-start"><i data-lucide="check-circle" class="w-4 h-4 mr-2 mt-1 text-green-400"></i>確認重要零組件證書 (承認書)</li>
                        </ul>
                        <button onclick="window.print()" class="mt-6 w-full bg-white text-slate-900 font-bold py-2 rounded hover:bg-slate-200 transition">
                            列印此報告
                        </button>
                    </div>

                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                        <h3 class="font-bold text-blue-900 mb-2">專家洞察</h3>
                        <p class="text-sm text-blue-800 italic">
                            "如果EMC測試失敗，請工廠不要只做簡單屏蔽，必須從源頭(濾波器、PCB佈局)修改。貿易商若無法讓工廠工程師直接介入，案子往往會拖延超過2個月。"
                        </p>
                        <div class="mt-2 text-xs text-blue-600 text-right">- 摘自實驗室現場經驗</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <button onclick="resetApp()" class="text-slate-500 hover:text-blue-600 underline">重新評估其他產品</button>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
            <p>© 2025 水類產品法規資料庫. 資料來源：BSMI、IEC 標準、實驗室現場答詢紀錄。</p>
            <p class="mt-1">本系統僅供初步評估，實際認證請諮詢專業實驗室 (如 ETC, UL, SGS 等)。</p>
        </div>
    </footer>

    <script>
        // State Management
        let appState = {
            type: '',
            components: [],
            origin: ''
        };

        // Navigation Logic
        function startGuide() {
            showStep('step-1');
        }

        function showStep(id) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        function prevStep() {
            const current = document.querySelector('.step-content.active').id;
            if (current === 'step-2') showStep('step-1');
            if (current === 'step-3') showStep('step-2');
            if (current === 'result-screen') showStep('step-3');
        }

        function selectOption(key, value) {
            appState[key] = value;
            
            if (key === 'type') {
                if (value === 'other') {
                    // Skip to manual result or simple screen
                    calculateResult(); // Logic to handle non-electric
                } else {
                    showStep('step-2');
                }
            } else if (key === 'origin') {
                calculateResult();
            }
        }

        function saveStep2() {
            appState.components = [];
            if(document.getElementById('comp_compressor').checked) appState.components.push('compressor');
            if(document.getElementById('comp_heater').checked) appState.components.push('heater');
            if(document.getElementById('comp_pcb').checked) appState.components.push('pcb');
            if(document.getElementById('comp_wifi').checked) appState.components.push('wifi');
            
            showStep('step-3');
        }

        function resetApp() {
            appState = { type: '', components: [], origin: '' };
            // Uncheck boxes
            document.querySelectorAll('input[type="checkbox"]').forEach(box => {
                box.checked = (box.id === 'comp_pcb'); // Default
            });
            showStep('welcome-screen');
        }

        // Logic Core
        function calculateResult() {
            showStep('result-screen');
            const summaryEl = document.getElementById('result-summary');
            const standardsEl = document.getElementById('standards-list');
            const riskEl = document.getElementById('risk-list');
            
            // 1. Generate Summary
            let typeName = '';
            switch(appState.type) {
                case 'dispenser': typeName = '開飲機/飲水機'; break;
                case 'kettle': typeName = '電熱水瓶/快煮壺'; break;
                case 'filter_electric': typeName = '電動淨水設備'; break;
                case 'other': typeName = '非電氣濾水器材'; break;
            }
            
            if (appState.type === 'other') {
                summaryEl.innerHTML = `您的產品屬於 <strong>${typeName}</strong>，通常不需要進行 BSMI 電氣安規驗證，但需符合「飲用水管理條例」及食品容器包裝衛生標準。`;
                standardsEl.innerHTML = `<div class="p-4 bg-gray-50 rounded border">無需電氣安規標準。請確認濾材符合 NSF 或 SGS 食品級測試。</div>`;
                riskEl.innerHTML = `<div class="text-sm text-gray-600">若產品宣稱有療效，需注意衛福部廣告法規。</div>`;
                return;
            }

            summaryEl.innerHTML = `您的產品為 <strong>${typeName}</strong>，產地設定為 <strong>${getOriginName(appState.origin)}</strong>。此產品屬於 BSMI 應施檢驗商品（RPC 驗證登錄 或 TABI 型式認可）。`;

            // 2. Generate Standards
            let htmlStandards = '';
            
            // Safety Standard
            htmlStandards += createStandardCard('安規標準 (Safety)', 'CNS 60335-1 (IEC 60335-1)', '家用電器一般要求');
            
            if (appState.type === 'dispenser' || appState.type === 'kettle') {
                htmlStandards += createStandardCard('安規標準 (特定)', 'CNS 60335-2-15', '液體加熱器之個別規定 (Heating Liquids)');
            }
            if (appState.components.includes('compressor')) {
                htmlStandards += createStandardCard('安規標準 (製冷)', 'CNS 60335-2-24', '製冷器具之個別規定 (Refrigerating Appliances)');
            }
            if (appState.type === 'filter_electric') {
                 // Often falls under general if no heating, or specific pump standards
                 htmlStandards += createStandardCard('安規標準 (特定)', 'CNS 60335-1', '主要檢測馬達過熱、絕緣距離等。');
            }

            // EMC Standard
            htmlStandards += createStandardCard('電磁相容 (EMC)', 'CNS 13783-1', '家用電器電磁干擾 (EMI) 及 磁場輻射測試');
            
            // Wireless
            if (appState.components.includes('wifi')) {
                htmlStandards += createStandardCard('無線射頻 (NCC)', 'NCC LP0002', '內含藍牙/Wi-Fi 模組需取得 NCC 證書或模組認證 ID。');
            }

            // Energy
            if (appState.type === 'dispenser') {
                htmlStandards += createStandardCard('能源效率', '能源局能效標章', '溫熱型/冰溫熱型開飲機需符合能源效率分級 (MEPS)。');
            }

            standardsEl.innerHTML = htmlStandards;

            // 3. Generate Risks
            let htmlRisks = '';

            // PCB V-0 Risk (From uploaded document)
            if (appState.components.includes('pcb')) {
                htmlRisks += createRiskCard('PCB 阻燃性標示 (High Risk)', 
                    '根據 IEC 60335-1 Clause 30，若 PCB 上無明確的 UL 94 V-0 認證編號或標誌，實驗室可能要求進行「針焰測試 (Needle Flame Test)」。',
                    '解決方案：請確保 PCB 供應商在板材上印刷 UL 黃卡號碼及 V-0 字樣，並提供效期內的 UL 證書。');
            }

            // Import/Trade Risk (From audio file)
            if (appState.origin === 'china_trade') {
                htmlRisks += createRiskCard('貿易商代理風險 (Critical)', 
                    '透過貿易商採購大陸電器，常發生 EMC 測試失敗時，貿易商無法提供電路修改方案，導致案件卡關超過 1.5 個月。',
                    '建議：下單前要求貿易商確認原廠是否有 EMC debug 能力，或要求提供完整電路圖供台灣實驗室修改。');
            }

            // Compressor Risk
            if (appState.components.includes('compressor')) {
                htmlRisks += createRiskCard('壓縮機證書', 
                    '壓縮機本身需有 IEC/UL 認證。若使用未認證的大陸製壓縮機，需在整機認證時加做壓縮機隨機測試，費用高且時間長。',
                    '檢查：確認壓縮機銘版上的認證標誌 (VDE, UL, TUV)。');
            }

            // Plug/Cord Risk
            htmlRisks += createRiskCard('電源線與插頭 (BSMI)', 
                '進口產品最常犯錯：插頭必須符合 CNS 690 (台灣規格)，不可使用歐規或大陸八字插頭加轉接頭。',
                '強制要求：電源線組必須單獨取得 BSMI 證書 (R字軌)。');

            riskEl.innerHTML = htmlRisks;
            lucide.createIcons();
        }

        // Helper Functions
        function getOriginName(val) {
            if (val === 'taiwan') return '台灣製造';
            if (val === 'china_trade') return '中國進口 (貿易商)';
            if (val === 'china_direct') return '中國進口 (直對原廠)';
            return '國外進口';
        }

        function createStandardCard(title, code, desc) {
            return `
            <div class="flex items-start p-4 bg-slate-50 rounded-lg border border-slate-200">
                <div class="bg-blue-100 p-2 rounded text-blue-600 mt-1 mr-3">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                </div>
                <div>
                    <h4 class="font-bold text-slate-800">${title}</h4>
                    <div class="text-blue-600 font-mono text-sm font-bold my-1">${code}</div>
                    <p class="text-sm text-slate-600">${desc}</p>
                </div>
            </div>`;
        }

        function createRiskCard(title, desc, solution) {
            return `
            <div class="border-l-4 border-red-500 bg-red-50 p-4 rounded-r-lg">
                <h4 class="font-bold text-red-800 flex items-center">
                    ${title}
                </h4>
                <p class="text-sm text-red-700 mt-1">${desc}</p>
                <div class="mt-2 text-sm bg-white bg-opacity-60 p-2 rounded text-red-800 font-medium">
                    <i data-lucide="lightbulb" class="w-4 h-4 inline mr-1"></i> ${solution}
                </div>
            </div>`;
        }

        // Initialize icons on load
        window.onload = function() {
            lucide.createIcons();
        };
    </script>
</body>
</html>